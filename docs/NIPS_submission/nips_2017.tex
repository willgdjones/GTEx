\documentclass{article}

% if you need to pass options to natbib, use, e.g.:
% \PassOptionsToPackage{numbers, compress}{natbib}
% before loading nips_2017
%
% to avoid loading the natbib package, add option nonatbib:
% \usepackage[nonatbib]{nips_2017}

\usepackage{nips_2017}

% to compile a camera-ready version, add the [final] option, e.g.:
% \usepackage[final]{nips_2017}

\usepackage[utf8]{inputenc} % allow utf-8 input
\usepackage[T1]{fontenc}    % use 8-bit T1 fonts
\usepackage{hyperref}       % hyperlinks
\usepackage{url}            % simple URL typesetting
\usepackage{booktabs}       % professional-quality tables
\usepackage{amsfonts}       % blackboard math symbols
\usepackage{nicefrac}       % compact symbols for 1/2, etc.
\usepackage{microtype}      % microtypography
\usepackage{graphicx}
\usepackage{pgfplotstable}
\usepackage{float}
\usepackage{csvsimple}
\usepackage[normalem]{ulem}
\graphicspath{{/Users/fonz/Documents/Projects/GTEx/plotting/}}

\title{Associating gene expression to neural network derived image features}

% The \author macro works with any number of authors. There are two
% commands used to separate the names and addresses of multiple
% authors: \And and \AND.
%
% Using \And between authors leaves it to LaTeX to determine where to
% break the lines. Using \AND forces a line break at that point. So,
% if LaTeX puts 3 of 4 authors names on the first line, and the last
% on the second line, try using \AND instead of \And before the third
% author name.

\author{
  David S.~Hippocampus\thanks{Use footnote for providing further
    information about author (webpage, alternative
    address)---\emph{not} for acknowledging funding agencies.} \\
  Department of Computer Science\\
  Cranberry-Lemon University\\
  Pittsburgh, PA 15213 \\
  \texttt{hippo@cs.cranberry-lemon.edu  asdfas} \\
  %% examples of more authors
  %% \And
  %% Coauthor \\
  %% Affiliation \\
  %% Address \\
  %% \texttt{email} \\
  %% \AND
  %% Coauthor \\
  %% Affiliation \\
  %% Address \\
  %% \texttt{email} \\
  %% \And
  %% Coauthor \\
  %% Affiliation \\
  %% Address \\
  %% \texttt{email} \\
  %% \And
  %% Coauthor \\
  %% Affiliation \\
  %% Address \\
  %% \texttt{email} \\
}

\begin{document}
% \nipsfinalcopy is no longer used

\maketitle

\begin{abstract}
I will be updating this document with the progress of  my NIPS 2017 submission.
\end{abstract}

\section*{Plan}

\subsection*{Q1: How much variability is shared between image features and expression?} 
\begin{enumerate}
\item \sout{Calculate PCA of image features and expression}

\item \sout{Calculate cross correlations between the PCs until 99.9\% variance is explained.}

\item \sout{Use the cross correlation measurements to derive total fraction of variance explained of images by expression: calculate $\sum_i \lambda_i \sum_j r^2_{ij} $ where $\lambda_i$ is the $i$th eigenvalue of the image feature PCA, $r^2_{ij}$ is the correlation of image feature PC $i$ with expression feature PC $j$.}

\item \sout{Make all of the above one-line-to-run for any combination of patch size, feature layer, tissue}

\item \sout{Report the value for each patch size, feature layer, tissue;} interpret findings

\end{enumerate}

\subsection*{Q2: How much of the shared variability is due to technical confounders?} 

\begin{enumerate}
\item \sout{Regress out known confounders $C$ from the image feature $F$ and expression data E. I.e., fit models $F \sim C + \epsilon$ and $E \sim C + \epsilon$. Use log scale for Ischemic time, monitor all scatter plots for confounders that are included in the model that the linear model assumptions hold. Decide whether to retain full model of all confounders x all genes/features, retain only significant associations, or do forward feature selection.}

\item \sout{Repeat steps Q1:1-5 above using the residuals of this model. }

\item \sout{Create a scatter plot of total shared variance vs. technical shared variance [again, all tissues etc.]}

\item Interpret findings in context of many tissues, scales, feature layers
\end{enumerate}

\subsection*{Q3: What genes share expression variability to visual features, and at which scales?}
\begin{enumerate}
\item \sout{Using residuals of technical confounders, fit linear model of expression vs. image feature - calculate effect sizes and p-values}

\item \sout{Apply multiple testing correction to derive a list of image feature associated genes.}

\item \sout{Sort genes based on variance explained by each image feature, perform GSEA or gProfiler ranked gene list analysis to test whether particular aspects of biology are enriched.} Interpret

\item Assess number of associations [total and per-feature] for different tissues, feature scales. Assess overlap of findings from gene list analyses. Interpret.
\end{enumerate}

\subsection*{Q3A: What genes are influenced by technical confounders?}
\begin{enumerate}

\item For each confounder, calculate the fraction of variance it explains for each gene expression level. 

\item Sort genes based on variance explained by confounder, perform GSEA or gProfiler ranked gene list analysis to test whether particular aspects of biology are enriched.]

\end{enumerate}

\subsection*{Once these done}
\begin{itemize}
\item Q4: What do the image features represent?
\item Q5: Is there a genetic basis to the image features?
\item Q6: Are there gene expression levels that cause image feature changes, or vice versa?
\item Q7: Are there image features that are associated with clinical annotations? Are any causal?

\end{itemize}

\section*{Methods}

\subsection*{Assessing shared variability between image features and expression}
We calculate principle components that capture 99.9\% of variation in the image features and expression features respectively. We repeat this after fitting a linear model containing known technical confounders to both the image features and expression, and regressing out these effects.

We choose the top 2000 transcripts with mean expression greater than one, and look for associations with the image features across tissue samples. For image features generated from Lung tissue, we plot a QQ-plot with 

\section*{Results}

Variability in expression explains a substantial amount of variability in the image features (Figure ???). Furthermore, almost 50\% of the variability in expression, and almost 40\% of the variability in the image features, is explained by 51 known technical factors (Figure ???)

\begin{figure}[H]
  \centering
    \includegraphics[width=0.5\linewidth]{/NIPS/compare_variance_explained} 
  \caption{Sample figure caption.}
\end{figure}


\begin{figure}[H]
  \centering
    \includegraphics[width=1\linewidth]{/TFCorrectedFeatureAssociations/tf_feature_selection_expression} 
  \caption{Sample figure caption.}
\end{figure}

\begin{figure}[H]
  \centering
    \includegraphics[width=1\linewidth]{/TFCorrectedFeatureAssociations/tf_feature_selection_image_features} 
  \caption{Sample figure caption.}
\end{figure}

%\pgfplotstableset{col sep=comma}{plotting/NIPS/ontology_results.csv}


\begin{table}[H]
\caption{Enriched Ontology terms for image feature 501}
\label{tab:image_feature_pcs_and_tfs}       % Give a unique label

\begin{tabular}{p{2cm}p{6cm}p{6cm}}
\hline\noalign{\smallskip}
p-value & Ontology & Genes  \\
1.21e-15 & lamellar body & LAMP3,CTSH,SFTPA1,NAPSA,SFTPD  \\
6.87e-09 & Defective ABCA3 causes pulmonary surfactant metabolism dysfunction type 3 (SMDP3) & SFTPA1,SFTPD,SFTPB,SFTPA2 \\


%\noalign{\smallskip}\svhline\noalign{\smallskip}
\noalign{\smallskip}\hline\noalign{\smallskip}
\end{tabular}
% $^a$ Table foot note (with superscript)
\end{table}

\begin{table}[H]
\caption{Enriched Ontology terms for image feature 3}
\label{tab:image_feature_pcs_and_tfs}       % Give a unique label

\begin{tabular}{p{2cm}p{6cm}p{6cm}}
\hline\noalign{\smallskip}
p-value & Ontology & Genes  \\
0.0498 & BRONCHIECTASIS WITH OR WITHOUT ELEVATED SWEAT CHLORIDE 3; BESC3;;CYSTIC FIBROSIS-LIKE SYNDROME & SCNN1G \\


%\noalign{\smallskip}\svhline\noalign{\smallskip}
\noalign{\smallskip}\hline\noalign{\smallskip}
\end{tabular}
% $^a$ Table foot note (with superscript)
\end{table}








%[1] Alexander, J.A.\ \& Mozer, M.C.\ (1995) Template-based algorithms
%for connectionist rule extraction. In G.\ Tesauro, D.S.\ Touretzky and
%T.K.\ Leen (eds.), {\it Advances in Neural Information Processing
%  Systems 7}, pp.\ 609--616. Cambridge, MA: MIT Press.
%
%[2] Bower, J.M.\ \& Beeman, D.\ (1995) {\it The Book of GENESIS:
%  Exploring Realistic Neural Models with the GEneral NEural SImulation
%  System.}  New York: TELOS/Springer--Verlag.
%
%[3] Hasselmo, M.E., Schnell, E.\ \& Barkai, E.\ (1995) Dynamics of
%learning and recall at excitatory recurrent synapses and cholinergic
%modulation in rat hippocampal region CA3. {\it Journal of
%  Neuroscience} {\bf 15}(7):5249-5262.




\end{document}
